{"version":3,"sources":["../src/index.js"],"names":["dotenv","config","builder","addonBuilder","manifest","findStreams","args","imdbId","id","console","log","torrents","type","client","getMovieTorrents","season","split","episode","getShowTorrents","defineStreamHandler","Promise","resolve","reject","then","streams","length","cacheMaxAge","catch","err","error","Date","toLocaleString","ZooqleClient","userName","process","env","USER","password","PASSWORD","userAgent","proxy","cache","addonInterface","getInterface"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;AACA;;AACA;;;;;;AAGAA,gBAAOC,MAAP;;AAEA,MAAMC,UAAU,IAAIC,6BAAJ,CAAiBC,iBAAjB,CAAhB;;SAEeC,W;;;;;mCAAf,WAA2BC,IAA3B,EAAiC;AAC/B,QAAIC,SAASD,KAAKE,EAAlB;;AAEA,QAAI,CAACD,MAAL,EAAa;AACXE,cAAQC,GAAR,CAAY,8BAAZ;AACA;AACD;;AAED,QAAIC,QAAJ;;AAEA,QAAIL,KAAKM,IAAL,KAAc,OAAlB,EAA2B;AACzBD,uBAAiBE,OAAOC,gBAAP,CAAwBP,MAAxB,CAAjB;AACD,KAFD,MAEO;AACL,YAAMQ,SAASR,OAAOS,KAAP,CAAa,GAAb,EAAkB,CAAlB,CAAf;AACA,YAAMC,UAAUV,OAAOS,KAAP,CAAa,GAAb,EAAkB,CAAlB,CAAhB;AACAT,eAASA,OAAOS,KAAP,CAAa,GAAb,EAAkB,CAAlB,CAAT;AACAL,uBAAiBE,OAAOK,eAAP,CAAuBX,MAAvB,EAA+BQ,MAA/B,EAAuCE,OAAvC,CAAjB;AACD;;AAED,WAAO,uCAAyBN,QAAzB,CAAP;AAED,G;;;;AAEDT,QAAQiB,mBAAR,CAA6Bb,IAAD,IAAU;AACpC,SAAO,IAAIc,OAAJ;AAAA;AAAA;AAAA,iCAAY,WAAOC,OAAP,EAAgBC,MAAhB,EAA2B;AAC5CjB,kBAAYC,IAAZ,EAAkBiB,IAAlB,CAAwBC,OAAD,IAAa;AAClC,YAAI,CAACA,WAAW,EAAZ,EAAgBC,MAApB,EAA4B;AAC1BJ,kBAAQ;AAAEG,mBAAF;AAAWE,yBAAa;AAAxB,WAAR;AACD,SAFD,CAEE;AAFF,aAGK;AACHJ,mBAAO;AAAEE,uBAAS,EAAX;AAAeE,2BAAa;AAA5B,aAAP;AACD,WANiC,CAMhC;;AACH,OAPD,EAOGC,KAPH,CAOUC,GAAD,IAAS;AAChB;AACAnB,gBAAQoB,KAAR,EACE;AACC,YAAIC,IAAJ,GAAWC,cAAX,EAAD,GACE,gEAHJ;AAKAtB,gBAAQoB,KAAR,CAAcvB,IAAd;AACAG,gBAAQoB,KAAR,CAAcD,GAAd;AACA;;AACAN,eAAOM,GAAP;AACD,OAlBD;AAmBD,KApBM;;AAAA;AAAA;AAAA;AAAA,MAAP;AAqBD,CAtBD;AAwBA,IAAIf,SAAS,IAAImB,qBAAJ,CAAiB;AAC5BC,YAAUC,QAAQC,GAAR,CAAYC,IADM;AAE5BC,YAAUH,QAAQC,GAAR,CAAYG,QAFM;AAG5BC,aAAW,gBAHiB;AAI5BC,SAAO,KAJqB;AAK5BC,SAAO;AALqB,CAAjB,CAAb;AAQA,MAAMC,iBAAiBxC,QAAQyC,YAAR,EAAvB;eAEeD,c","sourcesContent":["import { addonBuilder } from 'stremio-addon-sdk'\nimport dotenv from 'dotenv'\nimport ZooqleClient from './ZooqleClient'\nimport convertTorrentsToStreams from './convertTorrentsToStreams'\nimport manifest from './manifest'\n\n\ndotenv.config()\n\nconst builder = new addonBuilder(manifest)\n\nasync function findStreams(args) {\n  let imdbId = args.id\n\n  if (!imdbId) {\n    console.log('No IMDB ID in stream request')\n    return\n  }\n\n  let torrents\n\n  if (args.type === 'movie') {\n    torrents = await client.getMovieTorrents(imdbId)\n  } else {\n    const season = imdbId.split(':')[1]\n    const episode = imdbId.split(':')[2]\n    imdbId = imdbId.split(':')[0]\n    torrents = await client.getShowTorrents(imdbId, season, episode)\n  }\n\n  return convertTorrentsToStreams(torrents)\n\n}\n\nbuilder.defineStreamHandler((args) => {\n  return new Promise(async (resolve, reject) => {\n    findStreams(args).then((streams) => {\n      if ((streams || []).length) {\n        resolve({ streams, cacheMaxAge: 172800 })\n      } // two days\n      else {\n        reject({ streams: [], cacheMaxAge: 3600 })\n      } // one hour\n    }).catch((err) => {\n      /* eslint-disable no-console */\n      console.error(\n        // eslint-disable-next-line prefer-template\n        (new Date().toLocaleString()) +\n          ' An error has occurred while processing the following request:'\n      )\n      console.error(args)\n      console.error(err)\n      /* eslint-enable no-console */\n      reject(err)\n    })\n  })\n})\n\nlet client = new ZooqleClient({\n  userName: process.env.USER,\n  password: process.env.PASSWORD,\n  userAgent: 'stremio-zooqle',\n  proxy: false,\n  cache: '1',\n})\n\nconst addonInterface = builder.getInterface()\n\nexport default addonInterface\n"],"file":"index.js"}